<!doctype html>
<html lang="hr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ravnice — Kalkulator trapeznog lima</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2F2F2F"/>
<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: #f7f9fb;
}
.container {
  display: flex;
  flex-direction: column;
  height: 100%;
}
header {
  background: #2F2F2F;
  color: white;
  padding: 10px;
  text-align: center;
}
form {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 10px;
  gap: 10px;
  overflow-y: auto;
}
fieldset {
  background: white;
  border-radius: 8px;
  border: none;
  padding: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  padding: 5px;
  text-align: center;
  border-bottom: 1px solid #ddd;
}
tfoot td {
  font-weight: bold;
}
button {
  background: #0044cc;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
}
button:hover {
  background: #003399;
}
.actions {
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}
input[type="number"] {
  padding: 4px;
  font-size: 14px;
}
</style>
</head>
<body>
<div class="container">
<header>
  <h1>Ravnice — Kalkulator trapeznog lima</h1>
</header>
<form id="calcForm" onsubmit="return false;">
<fieldset>
  <label>Boja: <select id="boja">
    <option value="Crvena">Crvena</option>
    <option value="Plava">Plava</option>
    <option value="Zelena">Zelena</option>
  </select></label>
  <label>Materijal: 
    <select id="materijal">
      <option value="8">Pocinčani — 8.00 €/m²</option>
      <option value="12">Aluminij — 12.00 €/m²</option>
    </select>
  </label>
  <label>Tip:
    <select id="tip">
      <option value="T20">T20</option>
      <option value="T35">T35</option>
    </select>
  </label>
  <label><input type="checkbox" id="plastificirani"> Plastificirani (dodaj €/m²)</label>
  <input type="number" id="plastDod" value="2" step="0.1"> €/m²
</fieldset>
<fieldset>
  <table id="rowsTable">
    <thead>
      <tr><th>#</th><th>Količina</th><th>Duljina (mm)</th><th>Površina (m²)</th><th>Cijena reda (€)</th></tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr><td colspan="3">Ukupno:</td><td id="totalM2">0.00 m²</td><td id="totalEur">0.00 €</td></tr>
    </tfoot>
  </table>
  <div class="actions">
    <button type="button" id="addRow">+ Dodaj red</button>
    <button type="button" id="clearRows">Očisti sve</button>
    <button type="button" id="printBtn">Ispiši ponudu</button>
  </div>
</fieldset>
</form>
</div>

<script>
let rowCount = 0;
const tbody = document.querySelector('#rowsTable tbody');

function recalc() {
  let totalM2 = 0;
  let totalEur = 0;
  const materijal = parseFloat(document.getElementById('materijal').value);
  const plast = document.getElementById('plastificirani').checked ? parseFloat(document.getElementById('plastDod').value) : 0;

  tbody.querySelectorAll('tr').forEach(row => {
    const qty = parseFloat(row.querySelector('.qty').value) || 0;
    const lenmm = parseFloat(row.querySelector('.len').value) || 0;
    const lenm = lenmm / 1000;
    const m2 = qty * lenm * 1.0;
    const eur = m2 * (materijal + plast);
    row.querySelector('.m2').textContent = m2.toFixed(2);
    row.querySelector('.eur').textContent = eur.toFixed(2);
    totalM2 += m2;
    totalEur += eur;
  });
  document.getElementById('totalM2').textContent = totalM2.toFixed(2) + ' m²';
  document.getElementById('totalEur').textContent = totalEur.toFixed(2) + ' €';
}

document.getElementById('addRow').addEventListener('click', () => {
  rowCount++;
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${rowCount}</td>
    <td><input type="number" class="qty" value="1" min="1" style="width:70px"></td>
    <td><input type="number" class="len" value="1000" min="1" style="width:100px"></td>
    <td class="m2">0.00</td>
    <td class="eur">0.00</td>`;
  tbody.appendChild(tr);
  tr.querySelectorAll('input').forEach(inp => inp.addEventListener('input', recalc));
  recalc();
});

document.getElementById('clearRows').addEventListener('click', () => {
  tbody.innerHTML = '';
  rowCount = 0;
  recalc();
});

['materijal','plastificirani','plastDod'].forEach(id => {
  document.getElementById(id).addEventListener('input', recalc);
});

document.getElementById('printBtn').addEventListener('click', () => {
  window.print();
});

// Register service worker for PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js');
  });
}
</script>
</body>
</html>
